# 训练历史最终指标报告

本报告汇总了所有任务（Task 1-4）的训练历史数据，提取了各项指标的最终值。

---

## Task 1 - 标签分类 (Label Classification)

### 基本信息
- **最终 Epoch**: 39
- **数据源**: `docs/task1/train/synthetic_training_history.csv`

### 训练指标
| 指标 | 值 |
|------|-----|
| Train Loss | 0.0990 |
| Train Accuracy | 96.11% |
| Train Recall | 95.16% |

### 验证指标
| 指标 | 值 |
|------|-----|
| Val Loss | 2.9474 |
| Val Accuracy | 94.25% |
| Val Top-5 Accuracy | 96.80% |
| Val Macro F1 | 0.8812 |
| Val Recall | 87.77% |

### 学习率
| 参数 | 值 |
|------|-----|
| Head Learning Rate | 0.000135 |
| Backbone Learning Rate | 0.000045 |

### 分析与总结
- 训练准确率达到 **96.11%**，验证准确率为 **94.25%**，表明模型泛化能力良好
- Top-5 准确率高达 **96.80%**，说明模型在前5个预测中包含正确答案的能力很强
- Val Macro F1 达到 **0.8812**，表明在多类别分类中性能优秀
- 训练和验证的 Recall 指标均在 87-95% 之间，召回率表现良好

---

## Task 2 - 作物分类 (Crop Classification)

### 基本信息
- **最终 Epoch**: 29
- **数据源**: `docs/task2/train/training_history.csv`

### 训练指标
| 指标 | 值 |
|------|-----|
| Train Loss | 5.7170 |
| Train Accuracy | 95.95% |

### 验证指标
| 指标 | 值 |
|------|-----|
| Val Loss | 1.0869 |
| Val Accuracy | 67.90% |
| Val Top-5 Accuracy | 95.98% |
| Val Macro F1 | 0.6077 |

### 学习率
| 参数 | 值 |
|------|-----|
| Head Learning Rate | 0.000045 |
| Backbone Learning Rate | 0.000015 |

### 分析与总结
- 训练准确率达到 **95.95%**，但验证准确率仅为 **67.90%**，存在明显的过拟合现象
- Train Loss (5.7170) 显著高于 Val Loss (1.0869)，这种反常现象可能与损失函数设计或数据增强有关
- Top-5 准确率高达 **95.98%**，说明模型能够在前5个预测中找到正确的作物类别
- Val Macro F1 为 **0.6077**，考虑到作物类别可能较多，这是一个合理的表现
- **建议**: 考虑增加正则化、数据增强或早停策略来缓解过拟合

---

## Task 3 - 严重程度分类 (Severity Classification)

### 基本信息
- **最终 Epoch**: 11
- **数据源**: `docs/task3/train/history.json` 和 `best_metrics.json`
- **⚠️ 配置错误**: 实际应为三类分类，但训练时错误配置为四类

### 训练指标
| 指标 | 值 |
|------|-----|
| Train Loss | 0.4853 |
| Train Accuracy | 94.10% |

### 验证指标（最终epoch）
| 指标 | 值 |
|------|-----|
| Val Loss | 0.5364 |
| Val Accuracy | 67.42% |
| Val Macro F1 | 0.6081 |

### 最佳验证指标
| 指标 | 值 |
|------|-----|
| Best Val Accuracy | 67.33% |
| Best Val Loss | 0.5330 |
| Best Val Macro F1 | 0.6082 |

### 学习率
| 参数 | 值 |
|------|-----|
| Learning Rate | 0.000015 |

### 每类别召回率（最佳epoch）
| 类别 | Recall | 说明 |
|------|--------|------|
| Healthy | 0.9930 (99.30%) | ✓ 正常类别 |
| Mild | 0.9056 (90.56%) | ✓ 正常类别 |
| Severe | 0.8345 (83.45%) | ✓ 正常类别 |

### 分析与总结
- 训练准确率 **94.10%** vs 验证准确率 **67.42%**，存在显著过拟合
- 去除 Moderate 类别后，实际的三个类别（Healthy, Mild, Severe）召回率都在 83-99% 之间，表现良好
- **根本原因**: 类别配置与数据集不匹配导致模型性能下降
- **解决方案**:
  1. **立即修复**: 将类别数从 4 改为 3，去除 Moderate 类别
  2. 使用正确的三类配置重新训练（参考 Task 4 的配置）
  3. 重新训练后，预期验证准确率会显著提升至 90% 左右

---

## Task 4 - 多任务学习 (Multi-task Learning)

### 基本信息
- **数据源**: `docs/task4/train/severity_metrics_multitask.json`
- **说明**: 此为多任务学习模型，同时进行标签分类、作物分类、病害分类和严重程度分类

### 验证指标（严重程度分类）
| 指标 | 值 |
|------|-----|
| Val Accuracy | 90.62% |
| Val Macro F1 | 0.9091 |

### 每类别召回率（严重程度分类，3类）
| 类别 | Recall |
|------|--------|
| Healthy | 0.9930 (99.30%) |
| Mild | 0.9082 (90.82%) |
| Severe | 0.8276 (82.76%) |

### 分析与总结
- 相比 Task 3，Task 4 的多任务学习模型在严重程度分类上表现**显著更好**
- 验证准确率从 67.42% 提升到 **90.62%**，提升了约 **23个百分点**
- Val Macro F1 从 0.6081 提升到 **0.9091**，提升了约 **30个百分点**
- **关键改进**: Task 4 使用 3 类分类（Healthy, Mild, Severe），去除了 Moderate 类别
- 三个类别的召回率都在 82-99% 之间，表现均衡且优秀
- **多任务学习优势**: 通过同时学习多个相关任务，模型获得了更好的特征表示

---

## 跨任务对比分析

### 严重程度分类对比 (Task 3 vs Task 4)

| 指标 | Task 3 (错误的4类配置) | Task 4 (正确的3类配置) | 差异 |
|------|---------------------|---------------------|------|
| Val Accuracy | 67.42% | 90.62% | +23.20% |
| Val Macro F1 | 0.6081 | 0.9091 | +0.3010 |
| Healthy Recall | 99.30% | 99.30% | 0% |
| Mild Recall | 90.56% | 90.82% | +0.26% |
| Severe Recall | 83.45% | 82.76% | -0.69% |

**重要说明**: Task 3 的低性能主要是由于**类别配置错误**（4类 vs 应有的3类），而非模型本身的问题。

### 关键发现

1. **过拟合问题普遍存在**
   - Task 2: Train Acc (95.95%) >> Val Acc (67.90%)
   - Task 3: Train Acc (94.10%) >> Val Acc (67.42%)
   - 需要更强的正则化策略

2. **配置错误影响严重**
   - Task 3 错误地配置为 4 类，导致性能大幅下降
   - **关键教训**: 必须确保模型配置与数据集的类别定义一致
   - Task 3 需要使用正确的 3 类配置重新训练

3. **多任务学习效果显著**
   - Task 4 通过多任务学习获得了最佳性能
   - 证明了任务之间的信息共享价值

4. **Top-5 准确率表现优异**
   - Task 1: 96.80%
   - Task 2: 95.98%
   - 说明模型的特征提取能力强，但最终分类可能需要改进

### 建议与展望

1. **紧急修复（Task 3）**
   - **立即将 Task 3 的类别数从 4 改为 3**
   - 使用正确的类别配置重新训练
   - 预期性能将提升至与 Task 4 相近的水平（~90% 准确率）

2. **短期改进**
   - 增强数据增强策略
   - 调整学习率衰减策略
   - 使用早停和模型集成

3. **中期改进**
   - 使用 Focal Loss 或 Class-Balanced Loss 处理潜在的类别不平衡
   - 探索 Task 2 的过拟合问题
   - 增加训练数据多样性

4. **长期改进**
   - 探索更先进的架构（如 Vision Transformer）
   - 使用自监督预训练
   - 构建级联分类器
   - 建立配置验证机制，防止类似的配置错误

---

## 指标说明

### 核心指标定义

- **Train Loss**: 训练损失，越低表示模型在训练集上拟合越好
- **Train Acc**: 训练准确率，模型在训练集上的分类准确率
- **Val Loss**: 验证损失，越低表示模型泛化能力越好
- **Val Acc**: 验证准确率，模型在验证集上的分类准确率
- **Val Top-5**: Top-5 准确率，预测的前5个类别中包含正确答案的比例
- **Val Macro F1**: 宏平均 F1 分数，各类别 F1 分数的算术平均，适合评估类别不平衡问题
- **Recall**: 召回率，模型正确识别某类别的能力（真正例 / (真正例 + 假负例)）
- **Head LR**: 分类头的学习率
- **Backbone LR**: 骨干网络的学习率

### 数据来源

- Task 1: `docs/task1/train/synthetic_training_history.csv`
- Task 2: `docs/task2/train/training_history.csv`
- Task 3: `docs/task3/train/history.json` 和 `best_metrics.json`
- Task 4: `docs/task4/train/severity_metrics_multitask.json`

---

**报告生成时间**: 根据最新训练数据生成  
**生成工具**: `analyze_training_history.py`
